!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.wsc=t():e.wsc=t()}(window,function(){return function(n){var o={};function i(e){if(o[e])return o[e].exports;var t=o[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}return i.m=n,i.c=o,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,n){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function r(e){var o="function"==typeof Map?new Map:void 0;return(r=function(e){if(null===e||(t=e,-1===Function.toString.call(t).indexOf("[native code]")))return e;var t;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==o){if(o.has(e))return o.get(e);o.set(e,n)}function n(){return c(e,arguments,u(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),s(n,e)})(e)}function c(e,t,n){return(c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var o=[null];o.push.apply(o,t);var i=new(Function.bind.apply(e,o));return n&&s(i,n.prototype),i}).apply(null,arguments)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}n.r(t);var a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,u(t).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(t,r(Error)),t}();function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var p=function(){function o(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),void 0===e)throw new a("Required URL parameter is missing");if("object"!==f(n))throw new a("Options is must be an object");this._url=e,this._protocols=t,this._options=function(i){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},t=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(t=t.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),t.forEach(function(e){var t,n,o;t=i,o=r[n=e],n in t?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o})}return i}({},{useMessageQueue:!0,reconnection:!0,reconnectionOptions:{attempts:1/0,delay:1e3,maxDelay:5e3,increaseDelay:1e3}},n),this._webSocket=void 0,this._binaryType=void 0,this._extensions=void 0,this._protocol=void 0,this._standardEventQueue=[],this._customEventQueue=[],this._messageQueue=[],this._reconnectionAttemptAt=Date.now(),this._currentAttempts=0,this._currentReconnectionDelay=this._options.reconnectionOptions.delay,this._defineEvents()}var e,t,n;return e=o,(t=[{key:"connect",value:function(){var o=this;try{this._webSocket=new window.WebSocket(this._url,this._protocols)}catch(e){throw new a(e.message)}["binaryType","extensions","protocol"].forEach(function(e){void 0!==o["_"+e]&&(o._webSocket[e]=o[e])}),this._webSocket.addEventListener("open",function(e){o._currentAttempts=0,o._currentReconnectionDelay=o._options.reconnectionOptions.delay,o._sendMessagesFromQueue(),o._executeCustomEvents("ready",e)}),this._executeCustomEvents("opening"),this._addEventsFromStandardQueue(),this._options.reconnection&&this._webSocket.addEventListener("close",function(e){if(!e.wasClean&&o._currentAttempts<o._options.reconnectionOptions.attempts){var t=Date.now(),n=o._currentReconnectionDelay-(t-o._reconnectionAttemptAt);n<0?o.reconnect():setTimeout(function(){o.reconnect()},n),o._currentAttempts++,o._currentReconnectionDelay+=o._options.reconnectionOptions.increaseDelay,o._currentReconnectionDelay>o._options.reconnectionOptions.maxDelay&&(o._currentReconnectionDelay=o._options.reconnectionOptions.maxDelay)}})}},{key:"reconnect",value:function(){if(!(this._webSocket instanceof window.WebSocket))throw new a("WebSocket instance is not defined");this._reconnectionAttemptAt=Date.now(),this._webSocket.readyState===window.WebSocket.OPEN&&this._webSocket.close(),this.connect()}},{key:"send",value:function(e){this._webSocket instanceof window.WebSocket&&this._webSocket.readyState===window.WebSocket.OPEN?this._webSocket.send(e):this._options.useMessageQueue&&this._messageQueue.push(e)}},{key:"close",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1e3,t=1<arguments.length?arguments[1]:void 0;this._executeCustomEvents("closing"),this._messageQueue=[],this._standardEventQueue=[],this._customEventQueue=[],this._options.reconnection&&(this._currentAttempts=this._options.reconnectionOptions.attempts);try{this._webSocket.close(e,t)}catch(e){throw new a(e.message)}}},{key:"_defineEvents",value:function(){var o=this;this._standardEvents.forEach(function(n){var e="on"+n.charAt(0).toUpperCase()+n.slice(1);o[e]=function(t){o._webSocket instanceof window.WebSocket&&o._webSocket.addEventListener(n,function(e){t.call(o,n,e)}),o._standardEventQueue.push({eventType:n,callback:t})}}),this._customEvents.forEach(function(t){var e="on"+t.charAt(0).toUpperCase()+t.slice(1);o[e]=function(e){o._customEventQueue.push({eventType:t,callback:e})}})}},{key:"_addEventsFromStandardQueue",value:function(){var r=this;this._standardEventQueue.forEach(function(e,t,n){var o=e.eventType,i=e.callback;r._webSocket.addEventListener(o,function(e){i.call(r,o,e)})})}},{key:"_executeCustomEvents",value:function(r){var c=this,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this._customEventQueue.forEach(function(e,t,n){var o=e.eventType,i=e.callback;r===o&&i.call(c,o,s)})}},{key:"_sendMessagesFromQueue",value:function(){var o=this;this._messageQueue.forEach(function(e,t,n){o._webSocket.readyState===window.WebSocket.OPEN&&(o.send(e),delete n[t])})}},{key:"binaryType",get:function(){return this._webSocket instanceof window.WebSocket?this._webSocket.binaryType:void 0!==this._binaryType?f(this._binaryType):"blob"},set:function(e){this._binaryType=e,this._webSocket instanceof window.WebSocket&&(this._webSocket.binaryType=e)}},{key:"bufferedAmount",get:function(){return this._webSocket instanceof window.WebSocket?this._webSocket.bufferedAmount:0}},{key:"extensions",get:function(){return this._webSocket instanceof window.WebSocket?this._webSocket.extensions:void 0!==this._extensions?f(this._extensions):""},set:function(e){this._binaryType=extensions,this._webSocket instanceof window.WebSocket&&(this._webSocket.extensions=e)}},{key:"protocol",get:function(){return this._webSocket instanceof window.WebSocket?this._webSocket.protocol:void 0!==this._protocol?f(this._protocol):""},set:function(e){this._protocol=e,this._webSocket instanceof window.WebSocket&&(this._webSocket.extensions=e)}},{key:"readyState",get:function(){return this._webSocket instanceof window.WebSocket?this._webSocket.readyState:0}},{key:"url",get:function(){return this._webSocket instanceof window.WebSocket?this._webSocket.url:this._url}},{key:"_standardEvents",get:function(){return["open","message","close","error"]}},{key:"_customEvents",get:function(){return["opening","closing","ready"]}}])&&l(e.prototype,t),n&&l(e,n),o}();t.default=p}])});